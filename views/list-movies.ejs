<!DOCTYPE html>
<html>
<head lang="fr">
    <meta charset="UTF-8">
    <title>Liste des films</title>

    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="/css/materialize.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen"/>
</head>
<body class="list-movies">

<div class="navbar-fixed">
    <nav class="red darken-4">
        <div class="nav-wrapper">
            <a href="#!" class="brand-logo"></a>
            <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
            <ul class="side-nav" id="mobile-demo">
                <li><a href="/">Accueil</a></li>
                <li><a href="/about">A propos</a></li>
            </ul>
        </div>
    </nav>
</div>

<div id="content">
    <div id="list-movies"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/js/bin/materialize.min.js"></script>

<script>
    io = io.connect();
    var $ = jQuery;

    // Emit ready event.
    io.emit('ready');
    io.emit('list-movies');
    console.time('ready');

    // Listen for the talk event.
    io.on('ready', function () {
        console.timeEnd('ready');
        $(".button-collapse").sideNav();
    });

    // List of movies
    io.on('client-list-movies-local', function (data) {
        if (data) {
            //console.log(data);
            $('#list-movies').append(
                    '<div class="movie movie-vertical" movie="' + data.imdbID + '" releaseDate="' + (typeof(data.releaseDate) !== 'undefined' ? data.releaseDate : data.year + '-99-99') + '">' +
                    '<a href="/movie/' + data._id + '/details" filePath="' + data.filePath + '">' +
                    '<div class="title"><h2>' + data.title + '</h2></div>' +
                    '<div class="info"><span class="year">' + data.year + '</span></div>' +
                    '<img src="' + data.posterURL + '" />' +
                    '</a>' +
                    '</div>'
            );
        }
    });

    // Sort
    $('.sort-releasedate').on('click', function () {
        var movies = $('.movie');
        $('#list-movies').html('');
        var sort = $(movies).sort(function (a, b) {
            if ($(a).attr('releaseDate') !== 'undefined' && $(b).attr('releaseDate') !== 'undefined') {
                if ($(a).attr('releaseDate') > $(b).attr('releaseDate')) {
                    return false;
                } else {
                    return true;
                }
            }
            return false;

        });
        $.each(sort, function (key, value) {
            $('#list-movies').append($(value));
        });
    });
</script>

</body>
</html>